#!/bin/bash

COUNTRY=italy
OUTFILE=websites.txt
CATEGORYFILE=categories.txt

curl "https://www.similarweb.com/top-websites/$COUNTRY/" \
  -H 'authority: www.similarweb.com' \
  -H 'accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.9' \
  -H 'accept-language: en-US,en;q=0.9,it-IT;q=0.8,it;q=0.7,fr;q=0.6' \
  -H 'cache-control: max-age=0' \
  -H 'cookie: pxcts=93e86f91-c6f8-11ec-84f2-66556a6f495a; _pxvid=93e863f9-c6f8-11ec-84f2-66556a6f495a; _px3=9333221e831a7951a2f37305abf469b36145add756ba87ae41c9a2279d55d92a:k8+WMaP1BfqbOSDvBVXfJmYOYfgupCqcj8M5zCCN+1ogOQGfoISgSP9mcESg6TP/ukBc3wQb70Q7pWCo/u2v9Q==:1000:ZGJb7xK0Nd5X9cah8BwMySAtr9+sc4+N/mQzGf8ZM3t5MiIzXLKYhGTLrKx9Zj67saf7JY/1do73APxVZzjFfVN4O4B+wkXrByBtaxPhKaeCg3UKJtOQ6m5wZhsYcIjvvVNWFZ00tSRbCZxYIbOINEemDbpA31SI0p8SgZ+DNnrkA2MtyfjmFri8eJnKp6dgbreNOR76AkVpmqhm2H4mnQ==; locale=en-us; _vis_opt_s=1%7C; _vis_opt_test_cookie=1; _vwo_uuid=J82E7B69CCCE4D89AE8242D58FFF81C59; _vwo_ds=3%241651153159%3A16.04274202%3A%3A; _vwo_uuid_v2=D662B24243BFAF42AFBEE95F77CE47B7B|3f5703390334243855714c12d9bcea21; sgID=b2894c14-089c-fdf3-f562-19fad37c381d; loyal-user={%22date%22:%222022-04-28T13:39:20.344Z%22%2C%22isLoyal%22:false}; fsrndid=false; _gcl_au=1.1.870180693.1651153160; _vis_opt_exp_912_combi=2; _ga=GA1.2.175538432.1651153161; _gid=GA1.2.141033801.1651153161; _wingify_pc_uuid=5bec5a2fe9534089889c32b4a2e9c722; _hjFirstSeen=1; _hjIncludedInSessionSample=1; _hjSession_1406830=eyJpZCI6IjBhN2UyZWEzLWU5M2EtNGMzZS04ZGExLTQwNDU5NzRkNjkwMiIsImNyZWF0ZWQiOjE2NTExNTMxNjEyMDksImluU2FtcGxlIjp0cnVlfQ==; _hjAbsoluteSessionInProgress=0; __qca=P0-366676861-1651153161085; wingify_donot_track_actions=0; SNS=1; _sn_m={"r":{"n":1,"r":"similarweb"}}; _sn_n={"a":{"i":"b11b51c7-a5cd-4f90-8de0-256c6946aefb"}}; _sn_a={"a":{"s":1651153161953},"v":"26ee3c8b-edbb-41a2-91d9-0284e742ec75"}; intercom-id-e74067abd037cecbecb0662854f02aee12139f95=a2ad8ce2-85fb-4b53-9b6f-82203d62cfb5; intercom-session-e74067abd037cecbecb0662854f02aee12139f95=; _hjSessionUser_1406830=eyJpZCI6IjExNjNmMmM1LTVlZWMtNTU2Mi1hM2UyLWJlODZmNjEzZTg2NSIsImNyZWF0ZWQiOjE2NTExNTMxNjExNzIsImV4aXN0aW5nIjp0cnVlfQ==; _vis_opt_exp_912_goal_1=1; .AspNetCore.Antiforgery.xd9Q-ZnrZJo=CfDJ8N97SBhx0ylJmAU0eKH3sYYKXl4BCG4HD05yQA6IIS9BGUrt1br_iqskNJrRgqWhaIr1iAvVsT2KWk43lLA5rXOLUoD9j3qHI4wU4KCSpGUpHkqX97D7jpsrz7O12RgyqcAKOftA3lcxlEB0xwoAmQg; _vis_opt_exp_922_exclude=1; sc_is_visitor_unique=rx8617147.1651153222.8C20C0EA53A34F0542F820FDE1EBE5F7.1.1.1.1.1.1.1.1.1; _vwo_sn=0%3A6%3A%3A%3A1; _gat_UA-42469261-1=1; _uetsid=9bc14c80c6f811ec909371dd9d7fade3; _uetvid=9bc16c60c6f811eca3e8c7144c6d796a; mp_7ccb86f5c2939026a4b5de83b5971ed9_mixpanel=%7B%22distinct_id%22%3A%20%221807065ca78c3e-0a5585cbf608a2-53580614-384000-1807065ca79afd%22%2C%22%24device_id%22%3A%20%221807065ca78c3e-0a5585cbf608a2-53580614-384000-1807065ca79afd%22%2C%22%24initial_referrer%22%3A%20%22https%3A%2F%2Fwww.similarweb.com%2F%22%2C%22%24initial_referring_domain%22%3A%20%22www.similarweb.com%22%2C%22__mps%22%3A%20%7B%22%24os%22%3A%20%22Mac%20OS%20X%22%2C%22%24browser%22%3A%20%22Chrome%22%2C%22%24browser_version%22%3A%20100%2C%22%24initial_referrer%22%3A%20%22https%3A%2F%2Fwww.similarweb.com%2F%22%2C%22%24initial_referring_domain%22%3A%20%22www.similarweb.com%22%2C%22%24vwo_user_id%22%3A%20%22J82E7B69CCCE4D89AE8242D58FFF81C59%22%7D%2C%22__mpso%22%3A%20%7B%7D%2C%22__mpus%22%3A%20%7B%7D%2C%22__mpa%22%3A%20%7B%7D%2C%22__mpu%22%3A%20%7B%7D%2C%22__mpr%22%3A%20%5B%5D%2C%22__mpap%22%3A%20%5B%5D%2C%22sgId%22%3A%20%22b2894c14-089c-fdf3-f562-19fad37c381d%22%2C%22site_type%22%3A%20%22Lite%22%2C%22session_id%22%3A%20%22b3493f07-d7f7-4593-958b-5289917132e9%22%2C%22session_first_event_time%22%3A%20%222022-04-28T13%3A39%3A20.955Z%22%2C%22url%22%3A%20%22https%3A%2F%2Fwww.similarweb.com%2Ftop-websites%2F%22%2C%22language%22%3A%20%22en-us%22%2C%22section%22%3A%20%22top-websites%22%2C%22sub_section%22%3A%20%22%22%2C%22sub_sub_section%22%3A%20%22%22%2C%22sw_extention%22%3A%20false%2C%22last_event_time%22%3A%201651153222254%2C%22is_sw_user%22%3A%20false%2C%22mode%22%3A%20%22single%22%2C%22domain%22%3A%20%22instagram.com%22%2C%22is_small_site%22%3A%20false%2C%22is_ga_connected%22%3A%20false%2C%22first_time_visitor%22%3A%20false%2C%22country%22%3A%20%22999%22%2C%22main_category%22%3A%20%22All%22%7D' \
  -H 'referer: https://www.similarweb.com/website/instagram.com/' \
  -H 'sec-ch-ua: " Not A;Brand";v="99", "Chromium";v="100", "Google Chrome";v="100"' \
  -H 'sec-ch-ua-mobile: ?0' \
  -H 'sec-ch-ua-platform: "macOS"' \
  -H 'sec-fetch-dest: document' \
  -H 'sec-fetch-mode: navigate' \
  -H 'sec-fetch-site: same-origin' \
  -H 'sec-fetch-user: ?1' \
  -H 'upgrade-insecure-requests: 1' \
  -H 'user-agent: Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/100.0.4896.127 Safari/537.36' \
    | grep data-group-parent | cut -d '"' -f 2 | tr  _ - > $CATEGORYFILE


echo  -n "" > $OUTFILE
for category in $( cat $CATEGORYFILE ) ; do
    echo "# $category" >> $OUTFILE
    curl "https://www.similarweb.com/top-websites/${COUNTRY}/category/${category}/" \
  -H 'authority: www.similarweb.com' \
  -H 'accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.9' \
  -H 'accept-language: en-US,en;q=0.9,it-IT;q=0.8,it;q=0.7,fr;q=0.6' \
  -H 'cache-control: max-age=0' \
  -H 'cookie: pxcts=93e86f91-c6f8-11ec-84f2-66556a6f495a; _pxvid=93e863f9-c6f8-11ec-84f2-66556a6f495a; _px3=9333221e831a7951a2f37305abf469b36145add756ba87ae41c9a2279d55d92a:k8+WMaP1BfqbOSDvBVXfJmYOYfgupCqcj8M5zCCN+1ogOQGfoISgSP9mcESg6TP/ukBc3wQb70Q7pWCo/u2v9Q==:1000:ZGJb7xK0Nd5X9cah8BwMySAtr9+sc4+N/mQzGf8ZM3t5MiIzXLKYhGTLrKx9Zj67saf7JY/1do73APxVZzjFfVN4O4B+wkXrByBtaxPhKaeCg3UKJtOQ6m5wZhsYcIjvvVNWFZ00tSRbCZxYIbOINEemDbpA31SI0p8SgZ+DNnrkA2MtyfjmFri8eJnKp6dgbreNOR76AkVpmqhm2H4mnQ==; locale=en-us; _vis_opt_s=1%7C; _vis_opt_test_cookie=1; _vwo_uuid=J82E7B69CCCE4D89AE8242D58FFF81C59; _vwo_ds=3%241651153159%3A16.04274202%3A%3A; _vwo_uuid_v2=D662B24243BFAF42AFBEE95F77CE47B7B|3f5703390334243855714c12d9bcea21; sgID=b2894c14-089c-fdf3-f562-19fad37c381d; loyal-user={%22date%22:%222022-04-28T13:39:20.344Z%22%2C%22isLoyal%22:false}; fsrndid=false; _gcl_au=1.1.870180693.1651153160; _vis_opt_exp_912_combi=2; _ga=GA1.2.175538432.1651153161; _gid=GA1.2.141033801.1651153161; _wingify_pc_uuid=5bec5a2fe9534089889c32b4a2e9c722; _hjFirstSeen=1; _hjIncludedInSessionSample=1; _hjSession_1406830=eyJpZCI6IjBhN2UyZWEzLWU5M2EtNGMzZS04ZGExLTQwNDU5NzRkNjkwMiIsImNyZWF0ZWQiOjE2NTExNTMxNjEyMDksImluU2FtcGxlIjp0cnVlfQ==; _hjAbsoluteSessionInProgress=0; __qca=P0-366676861-1651153161085; wingify_donot_track_actions=0; SNS=1; _sn_m={"r":{"n":1,"r":"similarweb"}}; _sn_n={"a":{"i":"b11b51c7-a5cd-4f90-8de0-256c6946aefb"}}; _sn_a={"a":{"s":1651153161953},"v":"26ee3c8b-edbb-41a2-91d9-0284e742ec75"}; intercom-id-e74067abd037cecbecb0662854f02aee12139f95=a2ad8ce2-85fb-4b53-9b6f-82203d62cfb5; intercom-session-e74067abd037cecbecb0662854f02aee12139f95=; _hjSessionUser_1406830=eyJpZCI6IjExNjNmMmM1LTVlZWMtNTU2Mi1hM2UyLWJlODZmNjEzZTg2NSIsImNyZWF0ZWQiOjE2NTExNTMxNjExNzIsImV4aXN0aW5nIjp0cnVlfQ==; _vis_opt_exp_912_goal_1=1; .AspNetCore.Antiforgery.xd9Q-ZnrZJo=CfDJ8N97SBhx0ylJmAU0eKH3sYYKXl4BCG4HD05yQA6IIS9BGUrt1br_iqskNJrRgqWhaIr1iAvVsT2KWk43lLA5rXOLUoD9j3qHI4wU4KCSpGUpHkqX97D7jpsrz7O12RgyqcAKOftA3lcxlEB0xwoAmQg; _vis_opt_exp_922_exclude=1; sc_is_visitor_unique=rx8617147.1651153222.8C20C0EA53A34F0542F820FDE1EBE5F7.1.1.1.1.1.1.1.1.1; _vwo_sn=0%3A6%3A%3A%3A1; _gat_UA-42469261-1=1; _uetsid=9bc14c80c6f811ec909371dd9d7fade3; _uetvid=9bc16c60c6f811eca3e8c7144c6d796a; mp_7ccb86f5c2939026a4b5de83b5971ed9_mixpanel=%7B%22distinct_id%22%3A%20%221807065ca78c3e-0a5585cbf608a2-53580614-384000-1807065ca79afd%22%2C%22%24device_id%22%3A%20%221807065ca78c3e-0a5585cbf608a2-53580614-384000-1807065ca79afd%22%2C%22%24initial_referrer%22%3A%20%22https%3A%2F%2Fwww.similarweb.com%2F%22%2C%22%24initial_referring_domain%22%3A%20%22www.similarweb.com%22%2C%22__mps%22%3A%20%7B%22%24os%22%3A%20%22Mac%20OS%20X%22%2C%22%24browser%22%3A%20%22Chrome%22%2C%22%24browser_version%22%3A%20100%2C%22%24initial_referrer%22%3A%20%22https%3A%2F%2Fwww.similarweb.com%2F%22%2C%22%24initial_referring_domain%22%3A%20%22www.similarweb.com%22%2C%22%24vwo_user_id%22%3A%20%22J82E7B69CCCE4D89AE8242D58FFF81C59%22%7D%2C%22__mpso%22%3A%20%7B%7D%2C%22__mpus%22%3A%20%7B%7D%2C%22__mpa%22%3A%20%7B%7D%2C%22__mpu%22%3A%20%7B%7D%2C%22__mpr%22%3A%20%5B%5D%2C%22__mpap%22%3A%20%5B%5D%2C%22sgId%22%3A%20%22b2894c14-089c-fdf3-f562-19fad37c381d%22%2C%22site_type%22%3A%20%22Lite%22%2C%22session_id%22%3A%20%22b3493f07-d7f7-4593-958b-5289917132e9%22%2C%22session_first_event_time%22%3A%20%222022-04-28T13%3A39%3A20.955Z%22%2C%22url%22%3A%20%22https%3A%2F%2Fwww.similarweb.com%2Ftop-websites%2F%22%2C%22language%22%3A%20%22en-us%22%2C%22section%22%3A%20%22top-websites%22%2C%22sub_section%22%3A%20%22%22%2C%22sub_sub_section%22%3A%20%22%22%2C%22sw_extention%22%3A%20false%2C%22last_event_time%22%3A%201651153222254%2C%22is_sw_user%22%3A%20false%2C%22mode%22%3A%20%22single%22%2C%22domain%22%3A%20%22instagram.com%22%2C%22is_small_site%22%3A%20false%2C%22is_ga_connected%22%3A%20false%2C%22first_time_visitor%22%3A%20false%2C%22country%22%3A%20%22999%22%2C%22main_category%22%3A%20%22All%22%7D' \
  -H 'referer: https://www.similarweb.com/website/instagram.com/' \
  -H 'sec-ch-ua: " Not A;Brand";v="99", "Chromium";v="100", "Google Chrome";v="100"' \
  -H 'sec-ch-ua-mobile: ?0' \
  -H 'sec-ch-ua-platform: "macOS"' \
  -H 'sec-fetch-dest: document' \
  -H 'sec-fetch-mode: navigate' \
  -H 'sec-fetch-site: same-origin' \
  -H 'sec-fetch-user: ?1' \
  -H 'upgrade-insecure-requests: 1' \
  -H 'user-agent: Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/100.0.4896.127 Safari/537.36' \
  --compressed \
        | grep  data-shorturl | cut -d '"' -f 2 >> $OUTFILE

        sleep 30
done
